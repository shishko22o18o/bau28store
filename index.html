<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bau28Store ¬∑ –ú–∞–≥–∞–∑–∏–Ω –≤ Telegram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            min-height: 100vh;
            background: #0a0a0f;
            color: white;
            position: relative;
            overflow-x: hidden;
        }
        /* –§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–∑–∞–º–µ–Ω–∏ –ø—É—Ç—å –Ω–∞ —Å–≤–æ—ë) */
        .bg-custom {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: url('images/fon.jpg');
            background-size: cover;
            background-position: center;
            opacity: 0.4;
            z-index: 0;
        }
       
        
        
        .app {
            position: relative;
            z-index: 10;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px 16px 100px;
        }
        .logo {
            text-align: center;
            font-size: 48px;
            font-weight: 900;
            letter-spacing: 6px;
            text-shadow: 0 0 15px #b300ff, 0 0 30px #6a0dad;
            margin-bottom: 20px;
        }

        /* ========== –ö–ê–¢–ï–ì–û–†–ò–ò –° –ö–ê–†–¢–ò–ù–ö–ê–ú–ò –ù–ê –í–ï–°–¨ –ë–õ–û–ö ========== */
        .categories {
            display: grid;
            grid-template-columns: repeat(4,1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .cat-btn {
            position: relative;
            border-radius: 24px;
            overflow: hidden;
            cursor: pointer;
            aspect-ratio: 1/1.2;
            background-size: cover;
            background-position: center;
            border: 2px solid transparent;
            transition: 0.3s;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding: 8px;
        }
        .cat-btn::before {
            content: '';
            position: absolute;
            top:0; left:0; width:100%; height:100%;
            background: linear-gradient(to top, #000000b0, transparent);
            z-index: 1;
        }
        .cat-btn span {
            position: relative;
            z-index: 2;
            color: white;
            font-weight: 700;
            font-size: 14px;
            text-shadow: 0 2px 5px black;
            background: rgba(0,0,0,0.5);
            padding: 4px 12px;
            border-radius: 40px;
            backdrop-filter: blur(2px);
        }
        .cat-btn.active {
            border-color: #b829ff;
            box-shadow: 0 0 20px #b829ff;
            transform: scale(1.02);
        }
        /* –§–æ–Ω–æ–≤—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–∑–∞–º–µ–Ω–∏ –ø—É—Ç–∏ –Ω–∞ —Å–≤–æ–∏ .jpg) */
        .cat-btn[data-cat="clothes"] { background-image: url('images/cat_odezhda.jpg'); }
        .cat-btn[data-cat="accessories"] { background-image: url('images/cat_aksessuary.jpg'); }
        .cat-btn[data-cat="vape"] { background-image: url('images/cat_vape.jpg'); }
        .cat-btn[data-cat="electronics"] { background-image: url('images/cat_elektronika.jpg'); }

        .subcats {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .subcat {
            background: #1f0a2f;
            border: 1px solid #8a2be2;
            border-radius: 40px;
            padding: 6px 16px;
            font-size: 14px;
            color: #bbb;
            cursor: pointer;
        }
        .subcat.active {
            background: #b829ff;
            color: white;
            box-shadow: 0 0 15px #b829ff;
        }
        .filters {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            margin-bottom: 20px;
        }
        .filter-btn {
            background: #1f0a2f;
            border: 1px solid #8a2be2;
            border-radius: 40px;
            padding: 6px 14px;
            font-size: 14px;
            color: #ccc;
            cursor: pointer;
            white-space: nowrap;
        }
        .filter-btn.active {
            background: #b829ff;
            color: white;
        }
        .products-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        .product-card {
            background: rgba(10,5,15,0.7);
            backdrop-filter: blur(10px);
            border: 1px solid #a64dff;
            border-radius: 28px;
            overflow: hidden;
            cursor: pointer;
            transition: 0.2s;
        }
        .product-card:hover {
            transform: translateY(-5px);
            border-color: #b829ff;
            box-shadow: 0 10px 25px #b829ff;
        }
        .product-img {
            width: 100%;
            aspect-ratio: 1/1.2;
            object-fit: cover;
            background: #2a0a3a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }
        .product-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .product-info {
            padding: 12px;
        }
        .product-title {
            font-weight: 700;
            margin-bottom: 4px;
        }
        .product-price {
            color: #dbb6ff;
            font-weight: 800;
            margin-bottom: 8px;
        }
        .old-price {
            text-decoration: line-through;
            opacity: 0.6;
            margin-right: 6px;
            font-size: 14px;
        }
        .add-to-cart {
            width: 100%;
            background: linear-gradient(135deg, #8a2be2, #b829ff);
            border: none;
            color: white;
            font-weight: 700;
            padding: 10px;
            border-radius: 40px;
            cursor: pointer;
        }
        .cart-fixed {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 450px;
            background: #0c0c14f0;
            backdrop-filter: blur(20px);
            border: 2px solid #b829ff;
            border-radius: 60px;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        .cart-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .cart-count {
            background: #ff4081;
            border-radius: 20px;
            padding: 2px 8px;
            font-size: 14px;
            font-weight: 800;
        }
        .cart-total {
            font-weight: 800;
            color: #dbb6ff;
        }
        .checkout-btn {
            background: transparent;
            border: 2px solid #b829ff;
            color: white;
            font-weight: 600;
            padding: 8px 20px;
            border-radius: 40px;
            cursor: pointer;
        }
        .checkout-btn:disabled {
            opacity: 0.3;
            pointer-events: none;
        }
        .modal {
            display: none;
            position: fixed;
            top:0;left:0;width:100%;height:100%;
            background: #000000cc;
            backdrop-filter: blur(5px);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: #0c0c14;
            border: 2px solid #b829ff;
            border-radius: 32px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 24px;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 20px;
        }
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #333;
        }
        .cart-item-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .cart-item-qty {
            background: #222;
            padding: 4px 10px;
            border-radius: 20px;
        }
        .remove-btn {
            background: #ff4444;
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 15px;
            font-weight: 800;
            cursor: pointer;
        }
        .order-btn {
            width: 100%;
            background: linear-gradient(135deg, #b829ff, #8a2be2);
            border: none;
            color: white;
            font-weight: 800;
            padding: 14px;
            border-radius: 40px;
            margin-top: 20px;
            cursor: pointer;
        }
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #b829ff;
            color: white;
            padding: 12px 24px;
            border-radius: 40px;
            display: none;
            z-index: 1000;
        }
        .fav-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
        }
        .fav-count {
            background: #ff4081;
            border-radius: 20px;
            padding: 2px 8px;
            font-size: 14px;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <!-- –§–æ–Ω -->
    <div class="bg-custom"></div>
    <div class="lightning" id="lightning"></div>
    <div class="overlay"></div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <div class="app">
        <div class="logo">Bau28Store</div>

        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å —Ñ–æ–Ω–æ–≤—ã–º–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏ (jpg) -->
        <div class="categories" id="categories">
            <div class="cat-btn active" data-cat="clothes">
                <span>–û–¥–µ–∂–¥–∞</span>
            </div>
            <div class="cat-btn" data-cat="accessories">
                <span>–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</span>
            </div>
            <div class="cat-btn" data-cat="vape">
                <span>VAPE</span>
            </div>
            <div class="cat-btn" data-cat="electronics">
                <span>–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</span>
            </div>
        </div>

        <!-- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ VAPE -->
        <div class="subcats" id="vapeSubcats" style="display: none;">
            <div class="subcat active" data-sub="liquids">–ñ–∏–¥–∫–æ—Å—Ç–∏</div>
            <div class="subcat" data-sub="consumables">–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</div>
            <div class="subcat" data-sub="disposable">–û–¥–Ω–æ—Ä–∞–∑–∫–∏</div>
            <div class="subcat" data-sub="pods">POD-—Å–∏—Å—Ç–µ–º—ã</div>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="filters" id="filters">
            <div class="filter-btn active" data-filter="all">–í—Å–µ</div>
            <div class="filter-btn" data-filter="sale">–°–∫–∏–¥–∫–∏</div>
            <div class="filter-btn" data-filter="new">–ù–æ–≤–∏–Ω–∫–∏</div>
            <div class="filter-btn" data-filter="priceAsc">–¶–µ–Ω–∞ ‚Üë</div>
            <div class="filter-btn" data-filter="priceDesc">–¶–µ–Ω–∞ ‚Üì</div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–æ–≤–∞—Ä–æ–≤ -->
        <div class="products-grid" id="productsGrid"></div>

        <!-- –ö–Ω–æ–ø–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ -->
        <div style="position: fixed; top: 20px; right: 20px; z-index: 50; display: flex; align-items: center;">
            <button class="fav-btn" id="favBtn">‚ù§Ô∏è</button>
            <span class="fav-count" id="favCount">0</span>
        </div>
    </div>

    <!-- –ö–æ—Ä–∑–∏–Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è -->
    <div class="cart-fixed">
        <div class="cart-info">
            <span>üõí</span>
            <span class="cart-count" id="cartCount">0</span>
            <span class="cart-total" id="cartTotal">0 ‚ÇΩ</span>
        </div>
        <button class="checkout-btn" id="openCartBtn" disabled>–ö–æ—Ä–∑–∏–Ω–∞</button>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>–¢–≤–æ—è –∫–æ—Ä–∑–∏–Ω–∞</span>
                <button class="close-btn" id="closeCartBtn">‚úï</button>
            </div>
            <div id="cartItems" style="margin-bottom:20px;"></div>
            <div style="font-size:20px; font-weight:800; display:flex; justify-content:space-between;">
                <span>–ò—Ç–æ–≥–æ:</span>
                <span id="modalTotal">0 ‚ÇΩ</span>
            </div>
            <button class="order-btn" id="orderBtn">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ -->
    <div class="modal" id="favModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
                <button class="close-btn" id="closeFavBtn">‚úï</button>
            </div>
            <div id="favItems"></div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="notification" id="notification"></div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        (function() {
            // ==================== –ü–û–õ–£–ß–ï–ù–ò–ï –¢–û–í–ê–†–û–í –û–¢ –ë–û–¢–ê ====================
            // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ start_param –∏–ª–∏ query string
            function loadProductsFromBot() {
                let productsData = null;
                // 1. –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ Telegram WebApp start_param
                const tg = window.Telegram?.WebApp;
                if (tg && tg.initDataUnsafe && tg.initDataUnsafe.start_param) {
                    try {
                        productsData = JSON.parse(decodeURIComponent(tg.initDataUnsafe.start_param));
                    } catch (e) {}
                }
                // 2. –ï—Å–ª–∏ –Ω–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º URL query string (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
                if (!productsData) {
                    const urlParams = new URLSearchParams(window.location.search);
                    const dataParam = urlParams.get('data');
                    if (dataParam) {
                        try {
                            productsData = JSON.parse(decodeURIComponent(dataParam));
                        } catch (e) {}
                    }
                }
                return productsData;
            }

            // ==================== –¢–û–í–ê–†–´ –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ (–ï–°–õ–ò –ë–û–¢ –ù–ò–ß–ï–ì–û –ù–ï –ü–ï–†–ï–î–ê–õ) ====================
            const defaultProducts = {
                clothes: [
                    { id: 'c1', name: '–§—É—Ç–±–æ–ª–∫–∞ Oversize', price: 2990, img: 'images/tovary/futbolka.jpg', discount: 0, isNew: true },
                    { id: 'c2', name: '–•—É–¥–∏ —Å –ø—Ä–∏–Ω—Ç–æ–º', price: 4490, img: 'images/tovary/hudi.jpg', discount: 10 },
                    { id: 'c3', name: '–ö–∞—Ä–≥–æ —à—Ç–∞–Ω—ã', price: 3790, img: 'images/tovary/kargo.jpg' },
                    { id: 'c4', name: '–ë–µ–π—Å–±–æ–ª–∫–∞', price: 1990, img: 'images/tovary/bejsbolka.jpg', discount: 5 },
                ],
                accessories: [
                    { id: 'a1', name: '–ß–∞—Å—ã —Å—Ç–∞–ª—å/–∫–æ–∂–∞', price: 5490, img: 'images/tovary/chasy.jpg' },
                    { id: 'a2', name: '–û—á–∫–∏ Aviator', price: 2290, img: 'images/tovary/ochki.jpg' },
                    { id: 'a3', name: '–ß–æ–∫–µ—Ä —Å —à–∏–ø–∞–º–∏', price: 1190, img: 'images/tovary/choker.jpg' },
                ],
                vape: {
                    liquids: [
                        { id: 'v1', name: 'Bloody Mary 30ml', price: 890, img: 'images/tovary/liquid1.jpg' },
                        { id: 'v2', name: 'Ice Mint 30ml', price: 890, img: 'images/tovary/liquid2.jpg' },
                    ],
                    consumables: [
                        { id: 'v3', name: '–ò—Å–ø–∞—Ä–∏—Ç–µ–ª–∏ 0.6Œ©', price: 450, img: 'images/tovary/coils.jpg' },
                    ],
                    disposable: [
                        { id: 'v4', name: 'Elf Bar 600', price: 1290, img: 'images/tovary/elfbar.jpg' },
                    ],
                    pods: [
                        { id: 'v5', name: 'Caliburn G2', price: 2490, img: 'images/tovary/caliburn.jpg' },
                    ],
                },
                electronics: [
                    { id: 'e1', name: '–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏', price: 3990, img: 'images/tovary/airpods.jpg' },
                    { id: 'e2', name: 'Power bank 10000', price: 2190, img: 'images/tovary/powerbank.jpg' },
                ],
            };

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç –±–æ—Ç–∞, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ
            let products = loadProductsFromBot();
            if (!products) {
                products = defaultProducts;
            } else {
                // –ï—Å–ª–∏ –±–æ—Ç –ø—Ä–∏—Å–ª–∞–ª —Ç–æ–≤–∞—Ä—ã, –Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ–ø–æ–ª–Ω–∞—è, –º–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å
                // –ó–¥–µ—Å—å –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –±–æ—Ç –ø—Ä–∏—Å–ª–∞–ª –æ–±—ä–µ–∫—Ç —Ç–∞–∫–æ–π –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            }

            // ==================== –°–û–°–¢–û–Ø–ù–ò–ï ====================
            let currentCat = 'clothes';
            let currentSub = 'liquids';
            let currentFilter = 'all';
            let cart = [];
            let favorites = [];

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
            try {
                const savedCart = localStorage.getItem('bau28_cart');
                if (savedCart) cart = JSON.parse(savedCart);
                const savedFav = localStorage.getItem('bau28_fav');
                if (savedFav) favorites = JSON.parse(savedFav);
            } catch (e) {}

            // ==================== DOM –≠–õ–ï–ú–ï–ù–¢–´ ====================
            const productsGrid = document.getElementById('productsGrid');
            const cartCountSpan = document.getElementById('cartCount');
            const cartTotalSpan = document.getElementById('cartTotal');
            const modalTotalSpan = document.getElementById('modalTotal');
            const openCartBtn = document.getElementById('openCartBtn');
            const cartModal = document.getElementById('cartModal');
            const closeCartBtn = document.getElementById('closeCartBtn');
            const orderBtn = document.getElementById('orderBtn');
            const cartItemsDiv = document.getElementById('cartItems');
            const notification = document.getElementById('notification');
            const favCountSpan = document.getElementById('favCount');
            const favModal = document.getElementById('favModal');
            const favItemsDiv = document.getElementById('favItems');
            const favBtn = document.getElementById('favBtn');
            const closeFavBtn = document.getElementById('closeFavBtn');

            // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï ====================
            function formatPrice(p) {
                return p.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ') + ' ‚ÇΩ';
            }

            function showNotification(text) {
                notification.textContent = text;
                notification.style.display = 'block';
                setTimeout(() => notification.style.display = 'none', 1500);
            }

            function saveCart() {
                localStorage.setItem('bau28_cart', JSON.stringify(cart));
            }
            function saveFav() {
                localStorage.setItem('bau28_fav', JSON.stringify(favorites));
                favCountSpan.textContent = favorites.length;
            }

            // –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞ –ø–æ id (–≤–æ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö)
            function findProductById(id) {
                for (let cat in products) {
                    if (cat === 'vape') {
                        for (let sub in products.vape) {
                            const found = products.vape[sub].find(p => p.id === id);
                            if (found) return found;
                        }
                    } else {
                        const found = products[cat].find(p => p.id === id);
                        if (found) return found;
                    }
                }
                return null;
            }

            // ==================== –ö–û–†–ó–ò–ù–ê ====================
            function addToCart(product, qty = 1) {
                const existing = cart.find(i => i.id === product.id);
                if (existing) {
                    existing.quantity += qty;
                } else {
                    cart.push({
                        id: product.id,
                        name: product.name,
                        price: product.discount ? Math.round(product.price * (1 - product.discount/100)) : product.price,
                        quantity: qty
                    });
                }
                updateCartUI();
                saveCart();
                showNotification('‚úÖ –í –∫–æ—Ä–∑–∏–Ω–µ');
            }

            function removeFromCart(id) {
                cart = cart.filter(i => i.id !== id);
                updateCartUI();
                saveCart();
            }

            function changeQty(id, delta) {
                const item = cart.find(i => i.id === id);
                if (!item) return;
                item.quantity += delta;
                if (item.quantity <= 0) {
                    cart = cart.filter(i => i.id !== id);
                }
                updateCartUI();
                saveCart();
            }

            function updateCartUI() {
                const totalItems = cart.reduce((s, i) => s + i.quantity, 0);
                const totalSum = cart.reduce((s, i) => s + i.price * i.quantity, 0);
                cartCountSpan.textContent = totalItems;
                cartTotalSpan.textContent = formatPrice(totalSum);
                modalTotalSpan.textContent = formatPrice(totalSum);
                openCartBtn.disabled = cart.length === 0;

                if (cart.length === 0) {
                    cartItemsDiv.innerHTML = '<div style="text-align:center; color:#666;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';
                } else {
                    let html = '';
                    cart.forEach(item => {
                        html += `
                            <div class="cart-item">
                                <div>
                                    <div>${item.name}</div>
                                    <div style="color:#b829ff;">${formatPrice(item.price)}</div>
                                </div>
                                <div class="cart-item-controls">
                                    <button class="remove-btn" style="width:30px;" onclick="changeQty('${item.id}', -1)">‚àí</button>
                                    <span class="cart-item-qty">${item.quantity}</span>
                                    <button class="remove-btn" style="width:30px;" onclick="changeQty('${item.id}', 1)">+</button>
                                    <button class="remove-btn" onclick="removeFromCart('${item.id}')">‚úï</button>
                                </div>
                            </div>
                        `;
                    });
                    cartItemsDiv.innerHTML = html;
                }
            }

            // ==================== –ò–ó–ë–†–ê–ù–ù–û–ï ====================
            function toggleFavorite(product) {
                const index = favorites.findIndex(f => f.id === product.id);
                if (index === -1) {
                    favorites.push(product);
                } else {
                    favorites.splice(index, 1);
                }
                saveFav();
                renderProducts(); // –æ–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö
            }

            function isFavorite(id) {
                return favorites.some(f => f.id === id);
            }

            function openFavModal() {
                if (favorites.length === 0) {
                    favItemsDiv.innerHTML = '<div style="text-align:center; color:#666;">–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö</div>';
                } else {
                    let html = '';
                    favorites.forEach(p => {
                        const finalPrice = p.discount ? Math.round(p.price * (1 - p.discount/100)) : p.price;
                        html += `
                            <div class="cart-item">
                                <div>
                                    <div>${p.name}</div>
                                    <div style="color:#b829ff;">${formatPrice(finalPrice)}</div>
                                </div>
                                <button class="add-to-cart" style="width:auto; padding:5px 10px;" onclick="addToCart(findProductById('${p.id}')); openFavModal();">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                            </div>
                        `;
                    });
                    favItemsDiv.innerHTML = html;
                }
                favModal.classList.add('active');
            }

            // ==================== –ü–û–õ–£–ß–ò–¢–¨ –¢–ï–ö–£–©–ò–ô –°–ü–ò–°–û–ö –¢–û–í–ê–†–û–í ====================
            function getCurrentItems() {
                if (currentCat === 'vape') {
                    return products.vape[currentSub] || [];
                }
                return products[currentCat] || [];
            }

            function applyFilter(items) {
                let filtered = [...items];
                if (currentFilter === 'sale') {
                    filtered = filtered.filter(p => p.discount);
                } else if (currentFilter === 'new') {
                    filtered = filtered.filter(p => p.isNew);
                } else if (currentFilter === 'priceAsc') {
                    filtered.sort((a,b) => {
                        const pa = a.discount ? a.price*(1-a.discount/100) : a.price;
                        const pb = b.discount ? b.price*(1-b.discount/100) : b.price;
                        return pa - pb;
                    });
                } else if (currentFilter === 'priceDesc') {
                    filtered.sort((a,b) => {
                        const pa = a.discount ? a.price*(1-a.discount/100) : a.price;
                        const pb = b.discount ? b.price*(1-b.discount/100) : b.price;
                        return pb - pa;
                    });
                }
                return filtered;
            }

            // ==================== –û–¢–†–ò–°–û–í–ö–ê –ö–ê–†–¢–û–ß–ï–ö ====================
            function renderProducts() {
                const items = getCurrentItems();
                const filtered = applyFilter(items);
                let html = '';
                filtered.forEach(p => {
                    const finalPrice = p.discount ? Math.round(p.price * (1 - p.discount/100)) : p.price;
                    const favClass = isFavorite(p.id) ? '‚ù§Ô∏è' : 'ü§ç';
                    html += `
                        <div class="product-card" data-id="${p.id}">
                            <div class="product-img">
                                <img src="${p.img}" alt="${p.name}" onerror="this.style.display='none'; this.parentNode.innerHTML='üì¶';">
                            </div>
                            <div class="product-info">
                                <div class="product-title">${p.name}</div>
                                <div class="product-price">
                                    ${p.discount ? `<span class="old-price">${formatPrice(p.price)}</span>` : ''}
                                    ${formatPrice(finalPrice)}
                                </div>
                                <div style="display:flex; gap:5px;">
                                    <button class="add-to-cart" style="flex:3;" data-id="${p.id}">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                                    <button class="fav-btn" style="flex:1; font-size:24px;" data-id="${p.id}" data-fav="${favClass}">${favClass}</button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                productsGrid.innerHTML = html;

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                document.querySelectorAll('.add-to-cart[data-id]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const id = btn.dataset.id;
                        const product = findProductById(id);
                        if (product) addToCart(product);
                    });
                });
                document.querySelectorAll('.fav-btn[data-id]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const id = btn.dataset.id;
                        const product = findProductById(id);
                        if (product) {
                            toggleFavorite(product);
                            btn.textContent = isFavorite(id) ? '‚ù§Ô∏è' : 'ü§ç';
                        }
                    });
                });
            }

            // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
            function init() {
                // –ú–æ–ª–Ω–∏–∏
                const lightningDiv = document.getElementById('lightning');
                for (let i=0; i<6; i++) {
                    let b = document.createElement('div');
                    b.style.setProperty('--y', (10 + i*15) + '%');
                    b.style.setProperty('--rot', (i%2?8:-8) + 'deg');
                    lightningDiv.appendChild(b);
                }

                // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
                document.querySelectorAll('.cat-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        currentCat = btn.dataset.cat;
                        if (currentCat === 'vape') {
                            document.getElementById('vapeSubcats').style.display = 'flex';
                            currentSub = 'liquids';
                            document.querySelectorAll('.subcat').forEach(s => s.classList.remove('active'));
                            document.querySelector('.subcat[data-sub="liquids"]').classList.add('active');
                        } else {
                            document.getElementById('vapeSubcats').style.display = 'none';
                        }
                        renderProducts();
                    });
                });

                // –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                document.querySelectorAll('.subcat').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.subcat').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        currentSub = btn.dataset.sub;
                        renderProducts();
                    });
                });

                // –§–∏–ª—å—Ç—Ä—ã
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        currentFilter = btn.dataset.filter;
                        renderProducts();
                    });
                });

                // –ö–æ—Ä–∑–∏–Ω–∞
                openCartBtn.addEventListener('click', () => cartModal.classList.add('active'));
                closeCartBtn.addEventListener('click', () => cartModal.classList.remove('active'));
                cartModal.addEventListener('click', (e) => { if (e.target === cartModal) cartModal.classList.remove('active'); });

                // –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
                favBtn.addEventListener('click', openFavModal);
                closeFavBtn.addEventListener('click', () => favModal.classList.remove('active'));
                favModal.addEventListener('click', (e) => { if (e.target === favModal) favModal.classList.remove('active'); });

                // –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
                orderBtn.addEventListener('click', () => {
                    if (cart.length === 0) return;
                    const tg = window.Telegram?.WebApp;
                    if (tg) {
                        tg.sendData(JSON.stringify({
                            user: tg.initDataUnsafe?.user?.username || 'user',
                            items: cart,
                            total: cart.reduce((s,i) => s + i.price*i.quantity, 0)
                        }));
                        showNotification('–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
                    } else {
                        alert('–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω (—Ç–µ—Å—Ç)');
                    }
                    cart = [];
                    updateCartUI();
                    saveCart();
                    cartModal.classList.remove('active');
                });

                // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
                renderProducts();
                updateCartUI();
                favCountSpan.textContent = favorites.length;

                // Telegram
                if (window.Telegram?.WebApp) {
                    window.Telegram.WebApp.ready();
                    window.Telegram.WebApp.expand();
                }
            }

            init();

            // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ –¥–ª—è inline-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
            window.addToCart = addToCart;
            window.removeFromCart = removeFromCart;
            window.changeQty = changeQty;
            window.findProductById = findProductById;
            window.openFavModal = openFavModal;

        })();
    </script>
</body>

</html>

